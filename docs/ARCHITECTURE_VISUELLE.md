# ğŸ¨ Architecture Visuelle - SambaOne

## ğŸ“ Diagramme GÃ©nÃ©ral du SystÃ¨me

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     NAVIGATEUR (Frontend)                        â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚   Page       â”‚  â”‚   Page       â”‚  â”‚   Page       â”‚         â”‚
â”‚  â”‚   Login      â”‚  â”‚   Dashboard  â”‚  â”‚   Admin      â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚         â”‚                 â”‚                  â”‚                  â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                           â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚ HTTP Request
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SERVEUR NEXT.JS (Backend)                     â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                     API Routes                            â”‚  â”‚
â”‚  â”‚                                                           â”‚  â”‚
â”‚  â”‚  /api/admin/plan-features  â†’  GET/POST/PUT              â”‚  â”‚
â”‚  â”‚  /api/auth/sign-in         â†’  POST                      â”‚  â”‚
â”‚  â”‚  /api/organization/access  â†’  GET                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                       â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   Middleware       â”‚                                     â”‚  â”‚
â”‚  â”‚   â€¢ Authentication â”‚                                     â”‚  â”‚
â”‚  â”‚   â€¢ Authorization  â”‚                                     â”‚  â”‚
â”‚  â”‚   â€¢ RLS Check     â†“                                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚ SQL Queries
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SUPABASE (Database)                           â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚  plans   â”‚  â”‚ features â”‚  â”‚plan_features â”‚                 â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                 â”‚
â”‚  â”‚ id       â”‚  â”‚ id       â”‚  â”‚ id           â”‚                 â”‚
â”‚  â”‚ name     â”‚  â”‚ name     â”‚  â”‚ plan_id   â”€â”€â”€â”¼â”€â”€â†’ plans.id    â”‚
â”‚  â”‚ display  â”‚  â”‚ display  â”‚  â”‚ feature_idâ”€â”€â”€â”¼â”€â”€â†’ features.id â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ is_enabled   â”‚                 â”‚
â”‚                               â”‚ limits       â”‚                 â”‚
â”‚                               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Flux de DonnÃ©es DÃ©taillÃ©

### ScÃ©nario : Afficher la Page Admin Plan Features

```
â”Œâ”€â”€â”€ 1. UTILISATEUR VISITE /admin/plan-features â”€â”€â”€â”
â”‚                                                    â”‚
â”‚  Navigateur â†’ GET /admin/plan-features           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â†“
â”Œâ”€â”€â”€ 2. NEXT.JS CHARGE LA PAGE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                    â”‚
â”‚  app/(auth)/admin/plan-features/page.tsx          â”‚
â”‚  â€¢ VÃ©rifie l'authentification                     â”‚
â”‚  â€¢ Charge le composant React                      â”‚
â”‚  â€¢ ExÃ©cute useDataQuery()                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â†“
â”Œâ”€â”€â”€ 3. APPEL Ã€ L'API â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                    â”‚
â”‚  GET /api/admin/plan-features                     â”‚
â”‚  Headers: { Cookie: session_token }               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â†“
â”Œâ”€â”€â”€ 4. API TRAITE LA REQUÃŠTE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                    â”‚
â”‚  app/api/admin/plan-features/route.ts             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ 1. checkAuth() â†’ VÃ©rifie session            â”‚ â”‚
â”‚  â”‚ 2. isSuperAdmin() â†’ VÃ©rifie permissions     â”‚ â”‚
â”‚  â”‚ 3. Query Supabase:                          â”‚ â”‚
â”‚  â”‚    â€¢ SELECT * FROM plan_features            â”‚ â”‚
â”‚  â”‚    â€¢ SELECT * FROM plans WHERE id IN (...)  â”‚ â”‚
â”‚  â”‚    â€¢ SELECT * FROM features WHERE id IN (...â”‚ â”‚
â”‚  â”‚ 4. Combine les donnÃ©es                      â”‚ â”‚
â”‚  â”‚ 5. Transform en JSON                        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â†“
â”Œâ”€â”€â”€ 5. SUPABASE RETOURNE LES DONNÃ‰ES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                    â”‚
â”‚  PostgreSQL Database                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ SELECT pf.*, p.name, f.display_name         â”‚ â”‚
â”‚  â”‚ FROM plan_features pf                        â”‚ â”‚
â”‚  â”‚ LEFT JOIN plans p ON pf.plan_id = p.id      â”‚ â”‚
â”‚  â”‚ LEFT JOIN features f ON pf.feature_id = f.idâ”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â†“
â”Œâ”€â”€â”€ 6. API RETOURNE JSON â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                    â”‚
â”‚  {                                                 â”‚
â”‚    "plans": [                                     â”‚
â”‚      {                                            â”‚
â”‚        "id": "...",                               â”‚
â”‚        "displayName": "Freemium Plan",           â”‚
â”‚        "features": [                              â”‚
â”‚          {                                        â”‚
â”‚            "featureName": "Property Management", â”‚
â”‚            "isEnabled": true                     â”‚
â”‚          }                                        â”‚
â”‚        ]                                          â”‚
â”‚      }                                            â”‚
â”‚    ]                                              â”‚
â”‚  }                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â†“
â”Œâ”€â”€â”€ 7. REACT AFFICHE LES DONNÃ‰ES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                    â”‚
â”‚  â€¢ TanStack Query met en cache                    â”‚
â”‚  â€¢ React re-render le composant                   â”‚
â”‚  â€¢ Affiche le tableau avec les donnÃ©es            â”‚
â”‚                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Gestion des FonctionnalitÃ©s                 â”‚ â”‚
â”‚  â”‚                                              â”‚ â”‚
â”‚  â”‚ Freemium Plan         [====    ] 60%        â”‚ â”‚
â”‚  â”‚ â€¢ Property Management [ON]  [âœ“]             â”‚ â”‚
â”‚  â”‚ â€¢ Tenant Management   [ON]  [âœ“]             â”‚ â”‚
â”‚  â”‚                                              â”‚ â”‚
â”‚  â”‚ Professional Plan     [========] 90%        â”‚ â”‚
â”‚  â”‚ â€¢ Property Management [ON]  [âœ“]             â”‚ â”‚
â”‚  â”‚ â€¢ Advanced Reporting  [ON]  [âœ“]             â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” Flux d'Authentification

```
â”Œâ”€â”€â”€ UTILISATEUR NON CONNECTÃ‰ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                    â”‚
â”‚  Visite: /admin/plan-features                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â†“
â”Œâ”€â”€â”€ MIDDLEWARE VÃ‰RIFIE SESSION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                    â”‚
â”‚  middleware.ts                                     â”‚
â”‚  â€¢ Lit le cookie de session                       â”‚
â”‚  â€¢ Pas de session valide ?                        â”‚
â”‚    â†’ Redirect vers /auth/sign-in                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â†“
â”Œâ”€â”€â”€ PAGE DE LOGIN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                    â”‚
â”‚  /auth/sign-in                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Email: [____________]                      â”‚ â”‚
â”‚  â”‚  Password: [________]                       â”‚ â”‚
â”‚  â”‚  [Se connecter]                             â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚ Submit
                     â†“
â”Œâ”€â”€â”€ API LOGIN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                    â”‚
â”‚  POST /api/auth/sign-in                           â”‚
â”‚  â€¢ VÃ©rifie email + mot de passe                   â”‚
â”‚  â€¢ CrÃ©e une session Supabase                      â”‚
â”‚  â€¢ Retourne un cookie de session                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â†“
â”Œâ”€â”€â”€ UTILISATEUR CONNECTÃ‰ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                    â”‚
â”‚  Cookie: session_token=abc123...                  â”‚
â”‚  Redirect: /admin/plan-features                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â†“
â”Œâ”€â”€â”€ ACCÃˆS AUTORISÃ‰ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                    â”‚
â”‚  Page chargÃ©e avec succÃ¨s âœ“                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ›ï¸ Composants UI - HiÃ©rarchie

```
PlanFeaturesAdminPage
â”œâ”€â”€ Header
â”‚   â”œâ”€â”€ Title (h1)
â”‚   â””â”€â”€ RefreshButton
â”‚
â”œâ”€â”€ StatsCards (Grid)
â”‚   â”œâ”€â”€ Card (Total Plans)
â”‚   â”œâ”€â”€ Card (Total Features)
â”‚   â”œâ”€â”€ Card (Categories)
â”‚   â””â”€â”€ Card (Active Filters)
â”‚
â”œâ”€â”€ Tabs
â”‚   â”œâ”€â”€ TabsList
â”‚   â”‚   â”œâ”€â”€ TabTrigger (Matrix)
â”‚   â”‚   â”œâ”€â”€ TabTrigger (List)
â”‚   â”‚   â””â”€â”€ TabTrigger (Stats)
â”‚   â”‚
â”‚   â”œâ”€â”€ TabContent (Matrix View)
â”‚   â”‚   â””â”€â”€ Card
â”‚   â”‚       â”œâ”€â”€ CardHeader (Filters)
â”‚   â”‚       â”‚   â”œâ”€â”€ SearchInput
â”‚   â”‚       â”‚   â”œâ”€â”€ CategorySelect
â”‚   â”‚       â”‚   â””â”€â”€ StatusSelect
â”‚   â”‚       â”‚
â”‚   â”‚       â””â”€â”€ CardContent (Table)
â”‚   â”‚           â”œâ”€â”€ TableHeader
â”‚   â”‚           â”‚   â”œâ”€â”€ Column (Feature)
â”‚   â”‚           â”‚   â”œâ”€â”€ Column (Plan 1)
â”‚   â”‚           â”‚   â”œâ”€â”€ Column (Plan 2)
â”‚   â”‚           â”‚   â””â”€â”€ Column (Plan N...)
â”‚   â”‚           â”‚
â”‚   â”‚           â””â”€â”€ TableBody
â”‚   â”‚               â”œâ”€â”€ CategoryRow (Core Features)
â”‚   â”‚               â”œâ”€â”€ FeatureRow 1
â”‚   â”‚               â”‚   â”œâ”€â”€ Cell (Name)
â”‚   â”‚               â”‚   â”œâ”€â”€ Cell (Switch Plan 1)
â”‚   â”‚               â”‚   â””â”€â”€ Cell (Switch Plan 2)
â”‚   â”‚               â”‚
â”‚   â”‚               â”œâ”€â”€ CategoryRow (Financial)
â”‚   â”‚               â””â”€â”€ FeatureRow 2...
â”‚   â”‚
â”‚   â””â”€â”€ TabContent (List View)
â”‚       â””â”€â”€ Grid
â”‚           â”œâ”€â”€ PlanCard 1
â”‚           â”‚   â”œâ”€â”€ Header (Progress)
â”‚           â”‚   â””â”€â”€ FeaturesList
â”‚           â””â”€â”€ PlanCard 2...
â”‚
â””â”€â”€ Footer
```

---

## ğŸ“¦ Structure des DonnÃ©es

### Exemple de RÃ©ponse API

```json
{
  "plans": [
    {
      "id": "07b0a25a-dc04-4f65-b7da-3b35f07906c7",
      "name": "freemium",
      "displayName": "Freemium Plan",
      "description": "Free plan with basic features",
      "totalFeatures": 10,
      "enabledFeatures": 6,
      "features": [
        {
          "id": "d797282a-2c0e-47d4-83cf-68ac3cd31468",
          "featureId": "bf015fcd-7da4-49fe-85b2-21da9e570ef5",
          "featureName": "Property Management",
          "featureDescription": "Manage properties and buildings",
          "category": "Core Features",
          "isEnabled": true,
          "limits": { "max_properties": 5 },
          "createdAt": "2025-12-18T01:42:55.803314+00:00"
        }
      ],
      "featuresByCategory": {
        "Core Features": [
          { "featureName": "Property Management", "isEnabled": true },
          { "featureName": "Tenant Management", "isEnabled": true }
        ],
        "Financial": [
          { "featureName": "Rent Collection", "isEnabled": false }
        ]
      }
    }
  ],
  "totalPlans": 4,
  "totalFeatures": 23,
  "totalPlanFeatureRecords": 28
}
```

---

## ğŸ¯ Points d'EntrÃ©e de l'Application

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              POINTS D'ENTRÃ‰E                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                     â”‚
â”‚  PUBLIQUE (Sans authentification)                  â”‚
â”‚  â€¢ /                      â†’ Landing page           â”‚
â”‚  â€¢ /auth/sign-in          â†’ Page de connexion     â”‚
â”‚  â€¢ /auth/sign-up          â†’ Inscription           â”‚
â”‚  â€¢ /auth/forgot-password  â†’ Mot de passe oubliÃ©   â”‚
â”‚                                                     â”‚
â”‚  PROTÃ‰GÃ‰ (Avec authentification)                   â”‚
â”‚  â€¢ /dashboard             â†’ Tableau de bord        â”‚
â”‚  â€¢ /properties            â†’ Liste des propriÃ©tÃ©s   â”‚
â”‚  â€¢ /tenants               â†’ Gestion des locataires â”‚
â”‚  â€¢ /setup                 â†’ Configuration initiale â”‚
â”‚                                                     â”‚
â”‚  ADMIN (Super-admin seulement)                     â”‚
â”‚  â€¢ /admin/plan-features   â†’ Gestion des plans     â”‚
â”‚  â€¢ /admin/users           â†’ Gestion des users     â”‚
â”‚  â€¢ /admin/settings        â†’ ParamÃ¨tres globaux    â”‚
â”‚                                                     â”‚
â”‚  API (Endpoints serveur)                           â”‚
â”‚  â€¢ GET  /api/admin/plan-features                  â”‚
â”‚  â€¢ POST /api/admin/plan-features                  â”‚
â”‚  â€¢ PUT  /api/admin/plan-features                  â”‚
â”‚  â€¢ POST /api/auth/sign-in                         â”‚
â”‚  â€¢ GET  /api/organization/access                  â”‚
â”‚                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Cycle de Vie d'une RequÃªte

```
1. REQUÃŠTE
   User clicks â†’ Event Handler â†’ API Call
   
2. RÃ‰SEAU
   Fetch â†’ HTTP Request â†’ Next.js Server
   
3. SERVEUR
   Route Handler â†’ Middleware â†’ Auth Check
   
4. BASE DE DONNÃ‰ES
   SQL Query â†’ Supabase â†’ PostgreSQL
   
5. TRANSFORMATION
   Raw Data â†’ Business Logic â†’ JSON Format
   
6. RÃ‰PONSE
   JSON â†’ HTTP Response â†’ Network
   
7. CLIENT
   Response â†’ TanStack Query â†’ React State
   
8. AFFICHAGE
   State Update â†’ Re-render â†’ DOM Update â†’ UI Update
```

---

## ğŸ’¾ Gestion du Cache

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         STRATÃ‰GIE DE CACHE                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                     â”‚
â”‚  TanStack Query (React Query)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Key: ['plan-features-admin']                 â”‚ â”‚
â”‚  â”‚ Data: { plans: [...], totalPlans: 4 }        â”‚ â”‚
â”‚  â”‚ StaleTime: 5 minutes                         â”‚ â”‚
â”‚  â”‚ CacheTime: 30 minutes                        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                     â”‚
â”‚  StratÃ©gies:                                       â”‚
â”‚  â€¢ Premier appel â†’ Fetch depuis API               â”‚
â”‚  â€¢ Appels suivants â†’ Utilise le cache            â”‚
â”‚  â€¢ Mutation â†’ Invalidate cache automatiquement    â”‚
â”‚  â€¢ Refetch manuel â†’ Button "Actualiser"          â”‚
â”‚                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¨ Responsive Design

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         BREAKPOINTS TAILWIND                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                     â”‚
â”‚  Mobile (< 640px)                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚
â”‚  â”‚ â˜° Menu          â”‚  Stack vertical               â”‚
â”‚  â”‚ Card 1          â”‚  1 colonne                    â”‚
â”‚  â”‚ Card 2          â”‚  Tableau scrollable           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚
â”‚                                                     â”‚
â”‚  Tablet (640px - 1024px)                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚ Nav  â”‚ Card 1  â”‚  Card 2    â”‚  2 colonnes      â”‚
â”‚  â”‚      â”‚ Content â”‚  Content   â”‚  Sidebar rÃ©duit  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                                     â”‚
â”‚  Desktop (> 1024px)                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ Nav â”‚  Card 1  â”‚  Card 2  â”‚  Card 3   â”‚       â”‚
â”‚  â”‚     â”‚  Content â”‚  Content â”‚  Content  â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

Cette architecture visuelle aide Ã  comprendre comment toutes les piÃ¨ces s'assemblent ! ğŸ¯

